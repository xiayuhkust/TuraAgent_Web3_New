<!DOCTYPE html>
<html>
<head>
    <title>Web3 Wallet Test</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
</head>
<body>
    <h1>Web3 Wallet Test</h1>
    <button id="createWallet">Create Wallet</button>
    <div id="output"></div>

    <script>
        window.addEventListener('load', () => {
            const web3 = new Web3('https://43.135.26.222:8088');
            const output = document.getElementById('output');
            
            function log(msg) {
                const p = document.createElement('p');
                p.textContent = msg;
                output.appendChild(p);
                console.log(msg);
            }

            document.getElementById('createWallet').addEventListener('click', async () => {
                try {
                    log('Creating wallet...');
                    const account = web3.eth.accounts.create();
                    log(`Created wallet: ${account.address}`);

                    log('Sending private key to backend...');
                    const response = await fetch('https://app-pjdseuaf.fly.dev/api/v1/private-keys', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            private_key: account.privateKey,
                            address: account.address,
                            metadata: { description: "Test wallet creation" }
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Backend error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    log(`Private key stored in backend with ID: ${result.key_id}`);

                } catch (error) {
                    log(`Error: ${error.message}`);
                    console.error('Test failed:', error);
                }
            });
        });
    </script>
</body>
</html>
