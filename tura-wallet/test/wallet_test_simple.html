<!DOCTYPE html>
<html>
<head>
    <title>Simple Wallet Test</title>
    <link rel="stylesheet" href="../dist/assets/index-Dw9uFdpV.css">
    <script type="module">
        import { WalletManagerImpl } from '../src/lib/wallet_manager';
        
        window.addEventListener('load', () => {
            const output = document.getElementById('output');
            const log = (msg) => {
                output.innerHTML += `<p>${msg}</p>`;
                console.log(msg);
            };

            document.getElementById('createWallet').addEventListener('click', async () => {
                try {
                    log('Creating wallet...');
                    const walletManager = new WalletManagerImpl();
                    const password = `test-${Date.now()}`;
                    const wallet = await walletManager.createWallet(password);
                    log(`Created wallet: ${wallet.address}`);

                    const walletData = await walletManager.getWalletData(wallet.address, password);
                    log('Retrieved wallet data');

                    log('Sending private key to backend...');
                    const response = await fetch('https://app-pjdseuaf.fly.dev/api/v1/private-keys', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            private_key: walletData.privateKey,
                            address: wallet.address,
                            metadata: { description: "Test wallet creation" }
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Backend error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    log(`Private key stored in backend with ID: ${result.key_id}`);
                } catch (error) {
                    log(`Error: ${error.message}`);
                } finally {
                    log('Test completed');
                }
            });
        });
    </script>
</head>
<body>
    <h1>Simple Wallet Test</h1>
    <button id="createWallet">Create Wallet</button>
    <div id="output"></div>
</body>
</html>
